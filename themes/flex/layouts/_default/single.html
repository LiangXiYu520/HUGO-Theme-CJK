{{ define "main" }}
  <article>
    <div class="heading-wrap">
    {{ partial "heading.html" . }}
    <div class="des2">
    <time datetime="{{ .Date.Format "2006-01-02" }}">
    {{ .Date.Format (.Site.Params.dateFormatToUse | default "2006-01-02") }} > {{ .Lastmod.Format (.Site.Params.dateFormatToUse | default "2006-01-02") }}
    </time>　
<span>{{ .WordCount }} 字</span>
    </div>
    {{- $author_id := .Params.author | default .Site.Author.name -}}
    {{- $author := (index ($.Site.Data.author | default dict) $author_id) -}}
    {{- $author_lang := (index ($author | default dict) .Site.Language.Lang) -}}
    {{- $author_name := $author_lang.name.display | default $author.name.display | default $author_id -}}
    {{- with $.Site.GetPage "taxonomy" (printf "author/%s" $author_id) -}}
    <div class="des1">作者<a href="/author/{{ $author_name }}">{{- $author_name | safeHTML -}}/</a>
    {{- else -}}
    <div class="des1">作者<a href="/author/{{ $author_name }}">{{- $author_name | safeHTML -}}/</a>
    {{- end -}}

    {{ with .Params.categories -}}
        　分類{{ range . }}
        {{- $name := . -}}
        {{- with $.Site.GetPage "taxonomy" (printf "categories/%s" $name) | default ($.Site.GetPage "taxonomy" (printf "categories/%s" ($name | urlize))) -}}
      <span class="des1-cate"><a href="/categories/{{ $name }}">[{{- $name -}}]</a></span>
        {{ end -}}
        {{ end }}
    {{- end }}

    {{ with .Params.series -}}
        　系列{{ range . }}{{- $name := . -}}
        {{- with $.Site.GetPage "taxonomy" (printf "series/%s" $name) | default ($.Site.GetPage "taxonomy" (printf "series/%s" ($name | urlize))) -}}
        <span class="des1-tag"><a href="/series/{{ $name }}">#{{- $name -}}</a></span>
        {{ end -}}
        {{ end }}
    {{- end }}</div>
    <div class="pagi-wrap">
    <div class="pagi">
      {{ with .PrevInSection }}
        <span class=".pagi-prev">← <a href="{{ .RelPermalink }}">{{ .Title }}</a></span>
        {{- end }}
    {{ with .NextInSection }}
          　<span class=".pagi-next"><a href="{{ .RelPermalink }}">{{ .Title }}</a> →</span>
    {{- end }}
    </div></div>
    </div>
    <div class="u-wrapper">
      <div class="u-padding">
    <!--{{ partial "tags.html" . }}-->
    </div></div>
    {{ if or .Params.vertical (and .Site.Params.vertical (ne .Params.vertical false)) }}
<div class="vertical-wrap">
    <div class="vertical">
      {{ if .TableOfContents }}
        <li class="toc-item">{{ .TableOfContents }}</li>
      {{ end }}
    {{ .Content }}
    <div class="Tags-item-vertical">
    {{- if .Params.contentCopyright -}}
    <strong>版權</strong>　{{ .Params.contentCopyright | safeHTML }}
    {{- else -}}
      <strong>版權</strong>　{{ .Site.Params.contentCopyright | safeHTML }}
    {{- end -}}
    </div>
    </div></div>

      {{ else }}

          <div class="vertical-false">
            {{ if .TableOfContents }}
              <li class="toc-item">{{ .TableOfContents }}</li>
            {{ end }}
          {{ .Content }}
          <div class="Tags-item">
          {{- if .Params.contentCopyright -}}
          <strong>版權</strong>　{{ .Params.contentCopyright | safeHTML }}
          {{- else -}}
            <strong>版權</strong>　{{ .Site.Params.contentCopyright | safeHTML }}
          {{- end -}}
          </div>
          </div>
    {{ end }}
    <div class="u-wrapper">
      <div class="u-padding">
<div class="Tags  recommend" >
{{ $currentArticle := . }}
{{ $articles := where (where $.Site.Pages ".Kind" "eq" "page" ) ".Title" "!=" $currentArticle.Title }}
{{ $1RelevantArticles := slice }}
{{ $2RelevantArticles := slice }}
{{ $3RelevantArticles := slice }}
{{ $4RelevantArticles := slice }}
{{ range $idx, $article := $articles }}
{{ $1numberOfIntersection := len (intersect $article.Params.series $currentArticle.Params.series) }}
{{ $2numberOfIntersection := len (intersect $article.Params.categories $currentArticle.Params.categories) }}
{{ $5numberOfIntersection := add $1numberOfIntersection $2numberOfIntersection }}
{{ if (ge $5numberOfIntersection 4) }}
{{ $4RelevantArticles = $4RelevantArticles | append $article }}
{{ else if (eq $5numberOfIntersection 3) }}
  {{ $3RelevantArticles = $3RelevantArticles | append $article }}
  {{ else if (eq $5numberOfIntersection 2) }}
    {{ $2RelevantArticles = $2RelevantArticles | append $article }}
 {{ else if (eq $5numberOfIntersection 1) }}
      {{ $1RelevantArticles = $1RelevantArticles | append $article }}
{{ end }}
{{ end }}
{{ $recommendedArticles := slice }}
{{ range $4RelevantArticles }}
     {{ $recommendedArticles = $recommendedArticles | append . }}
{{ end }}
{{ range $3RelevantArticles }}
    {{ $recommendedArticles = $recommendedArticles | append . }}
{{ end }}
{{ range $2RelevantArticles }}
    {{ $recommendedArticles = $recommendedArticles | append . }}
{{ end }}
{{ range $1RelevantArticles }}
     {{ $recommendedArticles = $recommendedArticles | append . }}
{{ end }}
<div class="recommend1">
<h2>上篇</h2>
{{ with .PrevInSection }}
  <a href="{{ .RelPermalink }}">{{ .Title }}</a>
  {{- end }}
  <h2>下篇</h2>
{{ with .NextInSection }}
    <a href="{{ .RelPermalink }}">{{ .Title }}</a>
{{- end }}
</div>
<div class="recommend1">
<h2>發現 <span style="font-size:.6em;font-weight:400">據索引重合度排序</span></h2>
<ol>
{{- range (first 10 $recommendedArticles) -}}
<li>
  <a href="{{ .Permalink }}">
    {{ .Title }}
  </a>
</li>
{{ end }}
</ol>
</div>
</div>
{{ partial "comments.html" . }}
</div></div>
  </article>
  {{ partialCached "footer.html" . }}
{{ end }}
