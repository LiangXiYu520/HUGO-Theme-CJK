{{ define "main" }}
  <article>
    <div class="heading-wrap">
    {{ partial "heading.html" . }}
    </div>
    <div class="u-wrapper">
      <div class="u-padding">
    {{ partial "tags.html" . }}
    </div></div>
    {{ if or .Params.vertical (and .Site.Params.vertical (ne .Params.vertical false)) }}
<div class="vertical-wrap">
    <div class="vertical">
    {{ .Content }}
    </div></div>
      {{ else }}
          <div class="vertical-false">
          {{ .Content }}
          </div>
    {{ end }}
    <div class="u-wrapper">
      <div class="u-padding">
<div class="comment recommend" >
{{ $currentArticle := . }}
{{ $articles := where (where $.Site.Pages ".Kind" "eq" "page") ".Title" "!=" $currentArticle.Title }}
{{ $veryRelevantArticles := slice }}
{{ $relevantArticles := slice }}
{{ range $idx, $article := $articles }}
{{ $numberOfIntersections := len (intersect $article.Params.tags $currentArticle.Params.Tags) }}
{{ if (ge $numberOfIntersections 2) }}
{{ $veryRelevantArticles = $veryRelevantArticles | append $article }}
{{ else if (eq $numberOfIntersections 1) }}
  {{ $relevantArticles = $relevantArticles | append $article }}
{{ end }}
{{ end }}
{{ $recommendedArticles := slice }}
{{ range $veryRelevantArticles }}
    {{ $recommendedArticles = $recommendedArticles | append . }}
{{ end }}
{{ range $relevantArticles }}
        {{ $recommendedArticles = $recommendedArticles | append . }}
{{ end }}
<div class="recommend1">
<h2>上篇</h2>
{{ with .PrevInSection }}
  <a href="{{ .RelPermalink }}">{{ .Title }}</a>
  {{- end }}
  <h2>下篇</h2>
{{ with .NextInSection }}
    <a href="{{ .RelPermalink }}">{{ .Title }}</a>
{{- end }}
</div>
<div class="recommend1">
<h2>您可能還喜歡</h2>
<div>
{{ range (shuffle (first 10 $recommendedArticles)) }}
<div>
  <a href="{{ .Permalink }}">
    {{ .Title }}
  </a>
</div>
{{ end }}
</div></div>
</div></div></div>
<div class="u-wrapper">
    <div class="u-padding">
{{ partial "comments.html" . }}
</div></div>
  </article>
{{ end }}
