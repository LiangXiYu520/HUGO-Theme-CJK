{{ define "main" }}
  <article>
    <div class="heading-wrap">
    {{ partial "heading.html" . }}
    </div>
    <div class="u-wrapper">
      <div class="u-padding">
    {{ partial "tags.html" . }}
    </div></div>
    {{ if or .Params.vertical (and .Site.Params.vertical (ne .Params.vertical false)) }}
<div class="vertical-wrap">
    <div class="vertical">
    {{ .Content }}
    </div></div>
      {{ else }}
          <div class="vertical-false">
          {{ .Content }}
          </div>
    {{ end }}
    <div class="u-wrapper">
      <div class="u-padding">
<div class="comment recommend" >
{{ $currentArticle := . }}
{{ $articles := where (where $.Site.Pages ".Kind" "eq" "page") ".Title" "!=" $currentArticle.Title }}
{{ $veryRelevantArticles := slice }}
{{ $relevantArticles := slice }}
{{ range $idx, $article := $articles }}
{{ $numberOfIntersections := len (intersect $article.Params.tags $currentArticle.Params.Tags) }}
{{ if (ge $numberOfIntersections 2) }}
{{ $veryRelevantArticles = $veryRelevantArticles | append $article }}
{{ else if (eq $numberOfIntersections 1) }}
  {{ $relevantArticles = $relevantArticles | append $article }}
{{ end }}
{{ end }}
{{ $recommendedArticles := slice }}
{{ range $veryRelevantArticles }}
    {{ $recommendedArticles = $recommendedArticles | append . }}
{{ end }}
{{ range $relevantArticles }}
        {{ $recommendedArticles = $recommendedArticles | append . }}
{{ end }}
<h2>您可能還喜歡：</h2>
<ul>
{{ range (shuffle (first 10 $recommendedArticles)) }}
<li>
  <a href="{{ .Permalink }}">
    {{ .Title }}
  </a>
</li>
{{ end }}
</ul>
</div></div></div>

    <div class="pagi-wrap">
    <div class="pagi" style="  text-shadow: 0px 0px 7px white;">
      {{ with .PrevInSection }}
        <span class=".pagi-prev">← <a href="{{ .RelPermalink }}">{{ .Title }}</a></span>
        {{- end }}
    {{ with .NextInSection }}
          　<span class=".pagi-next"><a href="{{ .RelPermalink }}">{{ .Title }}</a> →</span>
    {{- end }}
    </div></div>
  <div class="u-wrapper">
    <div class="u-padding">
{{ partial "comments.html" . }}
</div></div>
  </article>
{{ end }}
