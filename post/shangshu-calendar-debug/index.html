<!doctype html><html lang=zh-hk><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="經過十天廢寢忘食的閉關，<v>尙書曆表</v>的主體部分終於完工。這是給自己看的debug記錄，沒什麼價値。<v>尙書曆表</v>暫時不在博客上發了，想看下能不能發表。"><meta name=generator content="Hugo 0.82.1"><title>古曆程序隨記 | 赫赫文王</title><link rel=canonical href=/post/shangshu-calendar-debug/><link rel=stylesheet href=/css/base.min.aaa52332f0cf1c9164fa2b1bcb3da057d4ff8d6aeb75692de53387f9f86d5a21.css integrity="sha256-qqUjMvDPHJFk+isbyz2gV9T/jWrrdWkt5TOH+fhtWiE=" crossorigin=anonymous></head><body><div class=heading-wrap><nav class=banner-wrap><div class="banner a1"><a href=/>主葉</a>
<a href=/#gallery>作品</a>
<details><summary>網誌</summary><div style="margin:auto -.5em auto 1em"><a href=/#discover>發現</a></div><div style="margin:auto -.5em auto 1em"><a href=/post>歸檔</a></div></details><details><summary>刊物</summary><div style="margin:auto -.5em auto 1em"><a href=/net>赫赫网摘</a></div><div style="margin:auto -.5em auto 1em"><a href=/xuekan>春秋學刊</a></div></details><details><summary>知識</summary><div style="margin:auto -.5em auto 1em"><a href=/read>赫赫蠹書</a></div><div style="margin:auto -.5em auto 1em"><a href=/tutorial>赫赫金鑰</a></div><div style="margin:auto -.5em auto 1em"><a href=/exam>考試筆記</a></div></details><details><summary>數據庫</summary><div style="margin:auto -.5em auto 1em"><a href=https://cal.kqh.me>赫赫曆藏</a></div><div style="margin:auto -.5em auto 1em"><a href=/#zanfu>赫赫讚府</a></div><div style="margin:auto -.5em auto 1em"><a href=/qinpu>赫赫琴藏</a></div><div style="margin:auto -.5em auto 1em"><a href=/#database>其他</a></div></details><a href="https://item.taobao.com/item.htm?id=629774535457" target=_blank>會員</a></div><div class="banner banner1"><input id=algolia-autocomplete placeholder="【Algolia 搜索】輸入後無需回車" class=search></div></nav><br><br><header class=Heading><span class="heading-title a1 finder"><a href=/>赫赫文王</a>»<a href=/post>网誌</a>»<a class=DocSearch-lvl0 href=/categories/%e6%9b%86>曆</a>»</span><h1 class="DocSearch-lvl1 heading-title a1 article">古曆程序隨記</h1><div class=des-taxo>經過十天廢寢忘食的閉關，<v>尙書曆表</v>的主體部分終於完工。這是給自己看的debug記錄，沒什麼價値。<v>尙書曆表</v>暫時不在博客上發了，想看下能不能發表。</div></header><section class=article-front><div class=article-card-container><div class=article-card-content style=background-image:url(https://pic.imgdb.cn/item/6003e0a13ffa7d37b372595e.jpg)></div></div><div class=article-info><div class="des-base des-des a1"><time datetime=2021-01-17>2021-01-17
> 2021-01-28</time></div><div class="des-base des-des a1"><span>3834 字</span>
<span class=svg><a href=https://github.com/kujihhoe/HUGO-Theme-CJK/blob/master/content/post/282-%e6%9b%86%e8%a1%a8%e8%a8%98%e9%8c%84.md target=_blank><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></a></span></div><div class="des-base des-des des-tag a1"><span>作者
<a href=/author/%e6%9f%af%e6%a3%8b%e7%80%9a>@柯棋瀚</a></span>
　<span>系列
<a href=/series/%e9%9b%a9%e8%8b%a5%e8%a8%98>雩若記｜</a></span>
　<span>標籤
<a href=/tags/coding>#coding</a></span></div><div class="des-base des-des des-tag a1"><span>版權 </span><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank>CC BY-NC-SA 4.0</a>，非商業用途可隨意使用</div></section></div><main><div class=verticlal-false-wrap><aside class="toc toc-verticlal-false"><li class=toc-item><nav id=TableOfContents><ul><li><a href=#問題>問題</a><ul><li><a href=#授時曆>授時曆</a></li><li><a href=#古曆>古曆</a></li></ul></li><li><a href=#誤差校驗>誤差校驗</a></li><li><a href=#說明>說明</a></li><li><a href=#隨記>隨記</a></li></ul></nav></li></aside><article class="DocSearch-content vertical-false"><h2 id=問題>問題</h2><h3 id=授時曆>授時曆</h3><ul><li>没有寫有㒳个條件下的FirstXianAnoma=什么，导致了NaN。出現以下問題：1007，1011，1012，1023，1037，1038，1049，1052，1053，1059，1063，1075，1079，1085，1089，1094，1095的定朔沒有最後一個月的干支，閏餘nan，分n</li><li>問題出在加減差，第一二月的太大了，導致定閏餘不對，導致連閏。問題出在遲疾差、FirstFaSlowV太大。問題出在FirstAnoma沒有化成正數。1012-1013-1014-1015，1031-1032，1040-1041，1058-1059，1075-1076，1080-1081，1093-1094，1328-1329經朔首尾是一樣的。1004年最後一月只有22天。1011年最後一月32天。1031、1032連閏</li><li>leapsuraccurate沒有化成正數。曆元前無閏月。問題的根源就是很多參數沒化成正數。解決方法就是「模加模」。</li><li>曆元前錯開了一月，子月顯示了丑月的干支。剛開始通過曆元前的年份-1朔策。11-14改成並行兩套系統，一套是經朔系統，把積日化成正數；一套是定朔系統，保留原來的負數。</li><li>曆元前中氣如果減去兩個朔策，冬至不對。那就減去一個中氣、一個朔策。但是後來又發現這樣還是不對，與把統積化成正數的正確方法比起來，這種方法在大約五分之二的年份，會有一個中氣相差一日。最後表都製好了，只能一年一年把授時曆的正確中氣粘貼過去。</li><li>最後的最後，發現原來不用那麼複雜，通積不用並行兩套，只要把閏餘化成正數就足夠了。</li></ul><h3 id=古曆>古曆</h3><ul><li>祖傳入蔀名稱問題從十天前剛開始編程就出現了，本以爲解決了，又出現，又解決，又出現，現在徹底解決。</li><li>又遇到入蔀年到底算上還是算外的問題。最後終於梳理清楚。崩潰。之前寫了那麼複雜的邏輯：</li></ul><blockquote><p>三統曆入統年的計算爲算外，需要在結果上+1。四分曆若在計算中得出的結果是0，實際情況是入紀年爲76，這時需要人工加以規定。三統曆由於算外，就不存在這一問題，結果爲0時入統年爲1。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>OriginYear</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>YuanRange</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>JiRange</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>BuRange</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifTong</span>

<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {

  <span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>76</span>

}
</code></pre></div><p>接下來計算蔀（統）序。四分曆在計算蔀序時需要減去一個很小的小數，目的是當入紀年除以蔀法76得整數，卽入蔀年爲76時，蔀序依然是上一蔀，而不是進位到下一蔀。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>BuOrder</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>OriginYear</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>YuanRange</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>JiRange</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>BuRange</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>0.00001</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>ifQuart</span>) 
</code></pre></div><p>而當入紀年爲0時，再減去一個小數就會變為負數，這時蔀序需要取0。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ifQuart</span>) {

  <span style=color:#a6e22e>BuOrder</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>BuOrder</span>)

}
</code></pre></div><p>若入紀年爲1520，卽該年入最後一蔀第20蔀丁酉蔀76年，則規定蔀序號爲19（第1蔀甲子蔀蔀序爲0）。由於MOD(1520,76)=MOD(0,76)=0，若不加以規定，結果與入紀年爲0時相同，爲甲子蔀1年。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>OriginYear</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>YuanRange</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>JiRange</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>ifQuart</span>) {

   <span style=color:#a6e22e>BuOrder</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>19</span>

}
</code></pre></div><p>之所以要區分是四分曆還是三統曆，因為三統曆在計算入蔀年時算外，而四分曆算上，所以三統曆不需要像四分曆一樣退一位。</p></blockquote><p>其實四分曆跟三統一樣也是算外。</p><p>本程序各曆入蔀年置閏判斷邏輯：</p><ul><li>建子冬至：13有 FirstMonNum==0 && WsolsticeOriginMon==0</li><li>建寅冬至、雨水：12有 FirstMonNum>0</li><li>建子雨水：13無 FirstMonNum==0 && WsolsticeOriginMon!=0</li></ul><table><thead><tr><th>曆元</th><th>入蔀年</th><th>FirstMonNum</th><th>LeapNumThisY</th><th>LeapNumNextY</th><th>ifAdvance</th><th>ifOriginLeapThisY</th><th>閏餘法月數</th><th>中氣</th></tr></thead><tbody><tr><td>建子冬至</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td></td><td>12</td><td>無</td></tr><tr><td></td><td>2</td><td></td><td>0</td><td>1</td><td>0</td><td></td><td>12</td><td>無</td></tr><tr><td></td><td>3</td><td></td><td>1</td><td>0</td><td>0</td><td></td><td>13</td><td>有</td></tr><tr><td>建寅冬至</td><td>1</td><td>2</td><td>0</td><td>0</td><td>0</td><td></td><td>12</td><td>無</td></tr><tr><td></td><td>2</td><td></td><td>0</td><td>1</td><td>0</td><td></td><td>13</td><td>無</td></tr><tr><td></td><td>3</td><td></td><td>1</td><td>0</td><td>0</td><td></td><td>12</td><td>有</td></tr><tr><td></td><td>8</td><td></td><td>0</td><td>1</td><td>1</td><td></td><td>13</td><td>有</td></tr><tr><td></td><td>9</td><td></td><td>1</td><td>0</td><td>1</td><td></td><td>12</td><td>無</td></tr><tr><td>建子雨水</td><td>76</td><td>0</td><td>0</td><td>1</td><td></td><td>1</td><td>12</td><td>無</td></tr><tr><td></td><td>1</td><td></td><td>1</td><td>0</td><td></td><td>0</td><td>13</td><td>有</td></tr><tr><td></td><td>2</td><td></td><td>0</td><td>1</td><td></td><td>0</td><td>12</td><td>無</td></tr><tr><td></td><td>3</td><td></td><td>1</td><td>0</td><td></td><td>1</td><td>13</td><td>有</td></tr><tr><td>建寅雨水</td><td>1</td><td>2</td><td>1</td><td>0</td><td>1</td><td></td><td>12</td><td>無</td></tr><tr><td></td><td>2</td><td></td><td>0</td><td>1</td><td>0</td><td></td><td>13</td><td>無</td></tr><tr><td></td><td>3</td><td></td><td>1</td><td>0</td><td>0</td><td></td><td>12</td><td>有</td></tr><tr><td></td><td>11</td><td></td><td>0</td><td>1</td><td>1</td><td></td><td>13</td><td>有</td></tr><tr><td></td><td>12</td><td></td><td>1</td><td>0</td><td>1</td><td></td><td>12</td><td>無</td></tr><tr><td>顓頊</td><td>1</td><td>-1</td><td>0</td><td>0</td><td>0</td><td></td><td>12</td><td>無</td></tr><tr><td></td><td>2</td><td></td><td>1</td><td>1</td><td>0</td><td></td><td>13</td><td>有</td></tr><tr><td></td><td>15</td><td></td><td>0</td><td>0</td><td>1</td><td></td><td>13</td><td>無</td></tr><tr><td></td><td>16</td><td></td><td>1</td><td>1</td><td>1</td><td></td><td>12</td><td>有</td></tr></tbody></table><h4 id=非冬至元積月問題>非冬至元積月問題</h4><p>突然發現非冬至元建子的積月數有問題，不能跟冬至閏年的實際情況相合，我就用了整整一個晚上來做找規律的遊戲。</p><img src=https://pic.imgdb.cn/item/6010cb4a3ffa7d37b3e3c2a7.jpg width=150><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>   <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>FirstMonNum</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>WsolsticeOriginMon</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ifOriginLeapThisY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifLeapPrevPrevY</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
            <span style=color:#a6e22e>FirstMonAccumMon</span> <span style=color:#f92672>-=</span> <span style=color:#a6e22e>ifLeapThisY</span>
        }  <span style=color:#75715e>//顓頊：3,6,8,9,10
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>ifOriginLeapPrevY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifLeapThisY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifLeapPrevPrevY</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>||</span> (<span style=color:#a6e22e>ifOriginLeapPrevY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifLeapThisY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifLeapPrevPrevY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifOriginLeapPrevPrevY</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)) {  
            <span style=color:#a6e22e>FirstMonAccumMon</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>ifOriginLeapThisY</span>
        }
        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>ifOriginLeapPrevY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifLeapThisY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifLeapNextY</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>||</span> (<span style=color:#a6e22e>ifOriginLeapPrevY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifLeapThisY</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ifLeapPrevPrevY</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>)) {  
            <span style=color:#a6e22e>FirstMonAccumMon</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>ifOriginLeapNextY</span>
        }
    }
</code></pre></div><p>按照上面這樣，按下葫蘆又起瓢，一晚上都沒調整好，還撤掉了不少頭髮。甚至用上了這些變量：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>OriginLeapPrevPrevY</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span> <span style=color:#f92672>-</span> Math.<span style=color:#a6e22e>floor</span>((<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>)
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>OriginLeapPrevY</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span> <span style=color:#f92672>-</span> Math.<span style=color:#a6e22e>floor</span>((<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>)
     <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>OriginLeapThisY</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span> <span style=color:#f92672>-</span> Math.<span style=color:#a6e22e>floor</span>((<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>)
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>OriginLeapNextY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span> <span style=color:#f92672>-</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>)
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>LeapSurPrevPrevY</span> <span style=color:#f92672>=</span> (((<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span> <span style=color:#f92672>-</span> Math.<span style=color:#a6e22e>floor</span>((<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>7</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>WsolsticeOriginMon</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>1</span>
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifOriginLeapThisY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>OriginLeapThisY</span> <span style=color:#f92672>&gt;=</span> parseFloat((<span style=color:#ae81ff>12</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>).<span style=color:#a6e22e>toPrecision</span>(<span style=color:#ae81ff>12</span>)) <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifOriginLeapNextY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>OriginLeapNextY</span> <span style=color:#f92672>&gt;=</span> parseFloat((<span style=color:#ae81ff>12</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>).<span style=color:#a6e22e>toPrecision</span>(<span style=color:#ae81ff>12</span>)) <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifLeapPrevPrevY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>LeapSurPrevPrevY</span> <span style=color:#f92672>&gt;=</span> parseFloat((<span style=color:#ae81ff>12</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>).<span style=color:#a6e22e>toPrecision</span>(<span style=color:#ae81ff>12</span>)) <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifOriginLeapPrevPrevY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>OriginLeapPrevPrevY</span> <span style=color:#f92672>&gt;=</span> parseFloat((<span style=color:#ae81ff>12</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>).<span style=color:#a6e22e>toPrecision</span>(<span style=color:#ae81ff>12</span>)) <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifOriginLeapPrevY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>OriginLeapPrevY</span> <span style=color:#f92672>&gt;=</span> parseFloat((<span style=color:#ae81ff>12</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span>).<span style=color:#a6e22e>toPrecision</span>(<span style=color:#ae81ff>12</span>)) <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>
</code></pre></div><p>睡了一覺起來，覺得這樣不是辦法，想到應該這樣：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>FirstMonAccumMon</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>((<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>235</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>19</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>WsolsticeOriginMon</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>FirstMonNum</span> <span style=color:#75715e>// 正月積月
</span></code></pre></div><p>積月加上一個閏餘修正就完美解決了。真是摸著石頭過河。</p><p>此外還有這種麻煩的判斷邏輯：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>FirstMonNum</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&amp;&amp;</span> ((<span style=color:#a6e22e>WsolsticeOriginMon</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>||</span> (<span style=color:#a6e22e>WsolsticeOriginMon</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>ifAdvance</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>||</span>(<span style=color:#a6e22e>WsolsticeOriginMon</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>ifAdvance</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>ifLeapThisY</span><span style=color:#f92672>==</span><span style=color:#ae81ff>1</span>)  ))
</code></pre></div><p>顓頊：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>WsolsticeAccumRaw</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>BuYear</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>solar</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>WsolsticeOriginDif</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>60</span>
</code></pre></div><p>之所以中氣置閏出問題，就在於最後WsolsticeOriginDif 沒有模，導致中氣比朔少60天。</p><p>授時曆：極端情況：1327 年閏餘18.3960199417，1328 年閏餘0.158988062985，1328年正月和冬至同爲乙丑（建子），所以正月就是閏月，但是不可能閏0月，怎麼辦呢？如果遇到閏0月，則退到去年的12月。1327當閏不閏。</p><h2 id=誤差校驗>誤差校驗</h2><ul><li><p>冬至日期：</p><ul><li><p>公元前1500年，授時曆比實曆提前6日</p></li><li><p>前1140、1000年提前4日</p></li><li><p>前500年提前2日</p></li><li><p>前100年提前1日</p></li><li><p>300、800、500、800、1200、1600年相等</p></li><li><p>1800年提前1日。</p></li></ul><p>所以授時曆在大約在公元300—1600年是非常準確的。公元前往上，誤差以大約250—300年1日的速度迅速擴大。這是為什麼呢？誤差為什麼不是線性增長？</p></li><li><p>我自己改了授時曆的回歸年、朔望月、近點月參數，新法在公元前1500—前500年基本與實曆相合。</p></li><li><p>中氣：</p><ul><li>公元1140年，授時只有一個與曆書平氣相差一天，新法都是對的</li><li>300年，新法基本提前平氣2天，授時提前3天，冬至新法與定氣相同，授時提前一天。不知是不是當時曆書平氣不太準。</li><li>前722年，新法比定氣晚1日或相同，授時跟殷曆相同或比殷曆提前1，殷曆比定氣提前1或2</li></ul></li><li><p>至於商代時間，<v>尙書</v>只有<v>伊訓</v><v>太甲中</v>兩篇僞古文可供討論，再結合<v>世經</v>，將商代年數劃定在公元前1752—1697（或者1739）年。</p></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ifLeapAvgThis</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>ifLeapAcrThis</span>) {
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifLeapAdvanceStartThis</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifLeapAdvanceEndThis</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ifLeapAvgThis</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>ifLeapAcrThis</span>) {
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifLeapAdvanceStartThis</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifLeapAdvanceEndThis</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
    } <span style=color:#66d9ef>else</span> {
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifLeapAdvanceStartThis</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ifLeapAvgThis</span>
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifLeapAdvanceEndThis</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ifLeapAcrThis</span>
    }
</code></pre></div><p>優化後：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifLeapAdvanceStartThis</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ifLeapAvgThis</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>ifLeapAcrThis</span>
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ifLeapAdvanceEndThis</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ifLeapAvgThis</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>ifLeapAcrThis</span>
</code></pre></div><h2 id=說明>說明</h2><p>比如，雨水元夏曆入蔀3、4年：</p><p>● <strong>雨夏</strong> 2758803天紀甲子蔀3 大18小255 冬大9雨水10.5 閏餘0439
<strong>朔</strong> 壬午 辛亥 辛巳 庚戌 庚辰 己酉 己卯 戊申 戊寅 戊申 丁丑 丁未<br><strong>分</strong> 2713 8021 3330 8638 3947 9255 4564 9872 5181 0489 5798 1106
<strong>望</strong> 丁酉 丙寅 丙申 乙丑 乙未 甲子 甲午 癸亥 癸巳 壬戌 壬辰 辛酉<br><strong>分</strong> 0367 5676 0984 6293 1601 6910 2218 7527 2835 8144 3452 8761<br><strong>中</strong> 甲辰 乙亥 乙巳 丙子 丙午 丁丑 丁未 □□ 戊寅 戊申 戊寅 己酉<br><strong>分</strong> 9375 3750 8125 2500 6875 1250 5625 □□ 0000 4375 8750 3125</p><p>● <strong>雨夏</strong> 2758804天紀甲子蔀4 大12小603 冬大14雨水15.75 閏餘4123
<strong>朔</strong> 丙子 丙午 乙亥 乙巳 甲戌 甲辰 癸酉 癸卯 壬申 壬寅 辛未 辛丑<br><strong>分</strong> 6415 1723 7032 2340 7649 2957 8266 3574 8883 4191 9500 4809
<strong>望</strong> 辛卯 庚申 庚寅 己未 己丑 己未 戊子 戊午 丁亥 丁巳 丙戌 丙辰<br><strong>分</strong> 4069 9378 4686 9995 5303 0612 5920 1229 6537 1846 7154 2463<br><strong>中</strong> 己卯 庚戌 庚辰 辛亥 辛巳 辛亥 壬午 壬子 癸未 癸丑 甲申 甲寅<br><strong>分</strong> 7500 1875 6250 0625 5000 9375 3750 8125 2500 6875 1250 5625</p><p>4年的年前冬至是戊寅。</p><p>置閏共有三種方法：閏餘法、無中氣法、固定冬至法，閏餘法可分為年中置閏、年末置閏兩種，無中氣法閏月必在年中（當然也可能在最後一個月），固定冬至法閏月必在年末。本表置閏採用閏餘法。第一行最後標注的閏月是閏餘年中置閏法的閏月，若採用閏餘年末置閏法，最後一個月就是閏月。中氣一行採用無中氣置閏法，有「□□」的年份爲無中氣置閏法的閏年，「□□」表示該月無中氣，爲閏月。固定冬至法的閏月必定置於年末，</p><p>無中氣法的閏月可能比閏餘年中法提前一個月：中氣與朔同在一日，中氣的時刻比朔早，則閏餘未達到閏準，還不能置閏；但是由於中氣與朔已經在一日了，絕大多數情況下上個月無中氣，需要置閏。</p><p>一個需要注意的細節是，如果閏餘法閏年在無中氣法的上年，那麼無中氣法的閏月需要加一，因為本表是按照閏餘法來排的。</p><h2 id=隨記>隨記</h2><ul><li><p>中午散步想到西曆其實很迷。 眞正的陽曆應該是這樣的：1 月一般 30 有日，1 日爲冬至；2 月一般有 29 日，1 日爲大寒；3 月有 30 日，1 日爲雨水；4 月有 31 日，1 日爲春分；5 月有 31 日，1 日爲穀雨；6 月有 31 日，1 日爲小滿，7 月有 31 日，1 日爲夏至；8 月有 32 日，1 日爲大暑⋯⋯每月的日數爲 29—32 日。壞處就是每月的日數沒那麼規則，需要像中曆一樣每年根據觀測結果來修正。然後看到伊朗曆其實就是這種思路，只是把春分作爲新年。</p></li><li><p>中國應該廢除春節，把新年改成從冬至到元旦的這十天。這樣旣符合傳統中歷的眞正新年，又能與公曆元旦接軌，又能與聖誕節接軌，不會與世界主流經濟作息錯開。</p></li><li><p>1 月 15 日：同學給我發了張照片，我看到月亮輪廓，說目測今天初三，一看日曆果然初三。這就是朏啊。</p></li><li><p>1 月 16 日：今天的月亮依然很细，但已经初四了。所以初三的更细，初二应该细到几乎不可见。</p></li><li><p><a href=https://www.desmos.com/calculator>在線繪製函數圖像</a></p></li><li><p>朱桂昌曆表後記的刊誤：<v>顓頊日曆表</v>第 528 頁元封七年四月二十九日應爲庚申，誤爲癸申。<v>太初日曆表</v>第 470、472 頁標題應爲神爵元年、神爵二年。</p></li><li><p>由於三統曆之後都採用無中氣置閏，所以不用考慮閏餘今年和明年的問題，因為無中氣都是看今年閏餘。</p></li><li><p>《後漢·律曆志下》：</p><blockquote><p>太初曆到章帝元和，旋復疏闊，徵能術者課校諸曆，定朔稽元，追漢（三）〔四〕十五年庚辰之歲，追朔一日，乃與天合，以爲四分曆元。加六百五元一紀，上得庚申。有近於緯，而歲不攝提，以辨曆者得開其説，而其元尠與緯同，同則或不得於天。</p></blockquote><p>得《後漢四分曆》上元積年605*4560+1520=2760320，爲公元前-160-2760320=-2760480</p></li></ul></article></div><nav class=pagi-wrap><div class="pagi a1"><a class="pagi-item pagi-prev" href=/post/iming2/><span class="des-base des-des">«« 上篇</span><br>一點明體與思源宋韓文版的比較與建議：設計篇</a>
<a class="pagi-item pagi-next" href=/post/midterm-leap/><span class="des-base des-des">下篇 »»</span><br>大小月、無中氣置閏圖；固定冬至、無中氣置閏圖</a></div></nav><div class=comment-wrap><div class=comment><div id=hyvor-talk-view></div><script type=text/javascript>var HYVOR_TALK_WEBSITE=1727,HYVOR_TALK_CONFIG={url:"https://kqh.me/post/shangshu-calendar-debug/",id:"d7aaa5d3019c3c59dadc82822c5651a0"}</script><script async type=text/javascript src=//talk.hyvor.com/web-api/embed></script></div></div><nav class="section section6"><h2>隨機推薦</h2><div class=discover-wrap style="margin:2em auto 3em"><div class="discover a1"><span><a href=https://kqh.me/post/midterm-leap/ target=_blank><div class=recommendation-card style=background-image:url(https://pic.imgdb.cn/item/6013db723ffa7d37b35e6ef1.jpg)></div></a></span></span><span><span class="des-base des-des"><time>2019-05-04</time> > 19-05-22</span>　<div class=discover-item><a href=https://kqh.me/162/ class=archive-post-link target=_blank>從尙書厤筭看王鳴盛的鄭學立場　摘要</a></div><div class="des-base des-des des-tag"><a style=font-size:.9em href=/author/%e6%9f%af%e6%a3%8b%e7%80%9a>@柯棋瀚</a>&nbsp<a style=font-size:.9em href=/categories/%e6%9b%86 target=_blank>[曆]</a>
<a style=font-size:.9em href=/series/%e9%9b%a9%e8%8b%a5%e8%a8%98 target=_blank>雩若記｜</a></div></span><span><a href=https://kqh.me/post/opening-report-2/ target=_blank><div class=recommendation-card style=background-image:url(https://pic.imgdb.cn/item/5fe99d2d3ffa7d37b3d3ef2c.jpg)></div></a></span></span><span><a href=https://kqh.me/read/early-calendar/ target=_blank><div class=recommendation-card style=background-image:url(https://pic.imgdb.cn/item/5fb65be8b18d627113ae1540.jpg)></div></a></span></span><span><a href=https://kqh.me/read/tongtianzhixue/ target=_blank><div class=recommendation-card style=background-image:url(https://pic.imgdb.cn/item/5fa263a21cd1bbb86b173007.jpg)></div></a></span></span><span><a href=https://kqh.me/226/ target=_blank><div class=recommendation-card style=background-image:url(https://pic.imgdb.cn/item/5f1fbec214195aa59489e8c3.jpg)></div></a></span></span><span><a href=https://kqh.me/223/ target=_blank><div class=recommendation-card style=background-image:url(https://pic.imgdb.cn/item/5f22212d14195aa594dfd532.jpg)></div></a></span></span><span><a href=https://kqh.me/net/history-rt4/ target=_blank><div class=recommendation-card style=background-image:url(https://pic.imgdb.cn/item/5f928e3d1cd1bbb86bf3fc4c.jpg)></div></a></span></span></div></div><h2>過去與未來的本周</h2><div class="recommend a1"><div><a href=/blog/2018/01/20/gcxs.html>走之前去髙雄走一走</a> <time class="des-base des-des a1">2018-01-20</time></div><div><a href=/blog/2018/01/21/ksmn.html>臺灣的孔廟</a> <time class="des-base des-des a1">2018-01-21</time></div></div></nav></main><footer class=footer-wrapper><nav class="col a2"><ul style=margin-top:1em;font-size:1.2em><li><a href=/ target=_blank>主頁</a></li><li><a href="https://item.taobao.com/item.htm?id=629774535457" target=_blank>成爲會員</a></li><li><a href=/about/>關於</a><div class="des-base des-des" style=margin-top:-.5em;font-size:.7em>20-08-24</div></li><li><a href=/privacy/>隱私安全</a><div class="des-base des-des" style=margin-top:-.5em;font-size:.7em>20-09-11</div></li><li><a href=/links/>友鏈</a><div class="des-base des-des" style=margin-top:-.5em;font-size:.7em>20-08-13</div></li><li><a href=/release/>更新日誌</a><div class="des-base des-des" style=margin-top:-.5em;font-size:.7em>20-09-18</div></li><li><a href=/donate/>捐助我</a><div class="des-base des-des" style=margin-top:-.5em;font-size:.7em>20-08-12</div></li></ul><ul style=margin-top:.85em;font-size:1.2em><li><a href=/#gallery>作品</a></li><li><a href=https://thefaint.cc>情形於聲</a></li><div class="des-base des-des" style=font-size:.7em>网誌</div><li><a href=/#discover>發現</a></li><li><a href=/post>歸檔</a></li><div class="des-base des-des" style=font-size:.7em>刊物</div><li><a href=/net>赫赫网摘</a></li><li><a href=/xuekan>春秋學刊</a></li></ul><ul style=margin-top:1em;font-size:1.2em><div class="des-base des-des" style=font-size:.7em>知識</div><li><a href=/read>赫赫蠹書</a></li><li><a href=/tutorial>赫赫金鑰</a></li><li><a href=/exam>考試筆記</a></li><div class="des-base des-des" style=font-size:.7em>數據庫</div><li><a href=https://cal.kqh.me>赫赫曆藏</a></li><li><a href=/#zanfu>赫赫讚府</a></li><li><a href=/qinpu>赫赫琴藏</a></li><li><a href=/#database>其他</a></li></ul></nav><nav class="col a2"><ul><h2>分類<span style=color:#d2c600;font-size:.7em> 12</span></h2><li><a href=https://kqh.me/categories/%E5%8F%B2/>史 81</a></li><li><a href=https://kqh.me/categories/%E7%B6%93/>經 72</a></li><li><a href=https://kqh.me/categories/%E7%94%9F%E6%B4%BB/>生活 55</a></li><li><a href=https://kqh.me/categories/%E7%90%B4/>琴 48</a></li><li><a href=https://kqh.me/categories/%E8%A5%8D/>襍 39</a></li><li><a href=https://kqh.me/categories/%E7%AB%99%E5%8B%99/>站務 19</a></li><li><a href=https://kqh.me/categories/%E5%93%B2%E7%A4%BE%E7%A7%91/>哲社科 18</a></li><li><a href=https://kqh.me/categories/%E6%9B%86/>曆 14</a></li><li><a href=https://kqh.me/categories/%E6%9B%B8/>書 9</a></li><li><a href=https://kqh.me/categories/%E6%BC%A2%E8%AA%9E/>漢語 9</a></li><li><a href=https://kqh.me/categories/%E5%BD%AB%E6%A2%93/>彫梓 8</a></li><li><a href=https://kqh.me/categories/%E6%96%87/>文 8</a></li></ul><ul><h2>系列<span style=color:#d2c600;font-size:.7em> 15</span></h2><li><a href=https://kqh.me/series/%E7%B4%80%E6%97%A5/>紀日 17</a></li><li><a href=https://kqh.me/series/%E8%AC%9B%E9%96%92%E8%AD%9A/>講閒譚 17</a></li><li><a href=https://kqh.me/series/%E7%AB%8B%E8%A8%80%E8%A8%98/>立言記 16</a></li><li><a href=https://kqh.me/series/%E3%A2%A7%E8%80%95%E8%A8%98/>㢧耕記 15</a></li><li><a href=https://kqh.me/series/%E5%8E%BB%E8%B5%B0%E8%B5%B0/>去走走 15</a></li><li><a href=https://kqh.me/series/%E8%A7%80%E5%BE%8C/>觀後 9</a></li><li><a href=https://kqh.me/series/%E4%B8%AD%E5%AD%B8/>中學 7</a></li><li><a href=https://kqh.me/series/%E3%A2%A7%E8%80%95%E7%9F%A5%E8%81%9E/>㢧耕知聞 6</a></li><li><a href=https://kqh.me/series/%E5%A2%A8%E6%B1%A0%E8%A8%98/>墨池記 5</a></li><li><a href=https://kqh.me/series/%E9%9B%A9%E8%8B%A5%E8%A8%98/>雩若記 5</a></li><li><a href=https://kqh.me/series/%E8%A8%AA%E7%90%B4%E8%A8%98/>訪琴記 4</a></li><li><a href=https://kqh.me/series/%E5%B0%BC%E5%87%A5%E8%A8%98/>尼凥記 1</a></li><li><a href=https://kqh.me/series/%E6%97%A0%E8%A1%BA%E8%A8%98/>无衺記 1</a></li><li><a href=https://kqh.me/series/%E7%8E%A8%E5%A3%B4%E8%A8%98/>玨壴記 1</a></li><li><a href=https://kqh.me/series/%E9%9A%B1%E9%BA%9F%E8%A8%98/>隱麟記 1</a></li></ul><ul><h2>作者<span style=color:#d2c600;font-size:.7em> 11</span></h2><li><a href=https://kqh.me/author/%E6%9F%AF%E6%A3%8B%E7%80%9A/>柯棋瀚 178</a></li><li><a href=https://kqh.me/author/%E6%9F%AF%E6%A3%8B%E7%80%9A%E5%AD%B8/>柯棋瀚學 100</a></li><li><a href=https://kqh.me/author/%E6%9F%AF%E6%A3%8B%E7%80%9A%E6%95%B4%E7%90%86/>柯棋瀚整理 87</a></li><li><a href=https://kqh.me/author/%E6%9F%AF%E6%A3%8B%E7%80%9A%E9%8C%84%E5%85%A5/>柯棋瀚錄入 23</a></li><li><a href=https://kqh.me/author/%E6%9F%AF%E6%A3%8B%E7%80%9A%E5%87%BA%E5%93%81/>柯棋瀚出品 8</a></li><li><a href=https://kqh.me/author/%E7%99%BD%E9%BA%B5%E9%A5%85%E9%A0%AD/>白麵饅頭 2</a></li><li><a href=https://kqh.me/author/%E5%90%B3%E7%89%A7/>吳牧 1</a></li><li><a href=https://kqh.me/author/%E6%A5%8A%E9%91%92%E7%90%AA/>楊鑒琪 1</a></li><li><a href=https://kqh.me/author/%E6%BD%98%E8%A5%BF%E9%BA%93/>潘西麓 1</a></li><li><a href=https://kqh.me/author/%E7%91%9A%E7%92%89%E7%90%B4%E7%A4%BE/>瑚璉琴社 1</a></li><li><a href=https://kqh.me/author/%E8%A7%A3%E8%88%AA/>解航 1</a></li><h2>備註<span style=color:#d2c600;font-size:.7em> 1</span></h2><li><a href=https://kqh.me/notes/%E8%AA%B2%E6%A5%AD/>課業 40</a></li><h2><a href=/tags>標籤<span style=font-size:.7em> 42</span></a></h2></ul></nav><div class="footer a2">訂閱｜<a href=/index.xml target=_blank style=font-weight:700>RSS</a>　<a href="https://kujihhoe.us17.list-manage.com/subscribe/post?u=3fb7b2733301fbcf39ec69597&id=6819d3d05d" target=_blank style=font-weight:700>SUBSCRIBE</a>　<a href=/sitemap.xml target=_blank>sitemap</a><br>copyright <a href=/>赫赫文王</a>　2017-10-03 > 2021<br>power <a href=https://gohugo.io target=_blank>Hugo</a>　theme <a href=https://github.com/kujihhoe/HUGO-Theme-CJK target=_blank>CJK</a>　host <a href=https://app.netlify.com/sites/kqh/deploys target=_blank>Netlify</a><div style="margin:1em auto">——— <a href=/about>關 於</a> ———</div><ul><li>email&iMessage // me[at]kqh[dot]me</li><li>PGP // <a href="/kujihhoe (E2269D07) public.asc" target=_blank>E2269D07</a></li><li><a href=/223>文章推薦算法</a></li><li><a href=/224>文章統計算法</a></li><li><a href=/149>板式</a></li><li><a href=/recommendation/blogroll>博客集合 blogroll</a></li><li>1920</li></ul><script async src="https://www.googletagmanager.com/gtag/js?id=UA-108451819-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-108451819-1')</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script><script type=text/javascript>docsearch({apiKey:'9b538ac6c3dacb030efa8d971bf15d1f',indexName:'kqh',inputSelector:'#algolia-autocomplete',debug:!1})</script></div></footer></body></html>